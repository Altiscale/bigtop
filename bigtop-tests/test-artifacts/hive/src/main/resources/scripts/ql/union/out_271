USE  TEST_HIVE_NORMAL


explain
SELECT *
FROM (
  SELECT 1 AS id
  FROM (SELECT * FROM src LIMIT 1) s1
  UNION
  SELECT 2 AS id
  FROM (SELECT * FROM src LIMIT 1) s1
  UNION
  SELECT 3 AS id
  FROM (SELECT * FROM src LIMIT 1) s2
  UNION
  SELECT 4 AS id
  FROM (SELECT * FROM src LIMIT 1) s2
) a CLUSTER BY id
STAGE DEPENDENCIES:
  Stage-1 is a root stage
  Stage-2 depends on stages: Stage-1, Stage-5
  Stage-3 depends on stages: Stage-2, Stage-6
  Stage-4 depends on stages: Stage-3, Stage-7
  Stage-5 is a root stage
  Stage-6 is a root stage
  Stage-7 is a root stage
  Stage-0 depends on stages: Stage-4

STAGE PLANS:
  Stage: Stage-1
    Map Reduce
      Map Operator Tree:
          TableScan
            alias: src
            Statistics: Num rows: 0 Data size: 280 Basic stats: PARTIAL Column stats: COMPLETE
            Select Operator
              Statistics: Num rows: 0 Data size: 280 Basic stats: PARTIAL Column stats: COMPLETE
              Limit
                Number of rows: 1
                Statistics: Num rows: 0 Data size: 280 Basic stats: PARTIAL Column stats: COMPLETE
                Reduce Output Operator
                  sort order: 
                  Statistics: Num rows: 0 Data size: 280 Basic stats: PARTIAL Column stats: COMPLETE
      Reduce Operator Tree:
        Limit
          Number of rows: 1
          Statistics: Num rows: 0 Data size: 280 Basic stats: PARTIAL Column stats: COMPLETE
          Select Operator
            expressions: 1 (type: int)
            outputColumnNames: _col0
            Statistics: Num rows: 0 Data size: 280 Basic stats: PARTIAL Column stats: COMPLETE
            File Output Operator
              compressed: false
              table:
                  input format: org.apache.hadoop.mapred.SequenceFileInputFormat
                  output format: org.apache.hadoop.hive.ql.io.HiveSequenceFileOutputFormat
                  serde: org.apache.hadoop.hive.serde2.lazybinary.LazyBinarySerDe

  Stage: Stage-2
    Map Reduce
      Map Operator Tree:
          TableScan
            Union
              Statistics: Num rows: 0 Data size: 560 Basic stats: PARTIAL Column stats: COMPLETE
              Group By Operator
                keys: _col0 (type: int)
                mode: hash
                outputColumnNames: _col0
                Statistics: Num rows: 0 Data size: 0 Basic stats: NONE Column stats: COMPLETE
                Reduce Output Operator
                  key expressions: _col0 (type: int)
                  sort order: +
                  Map-reduce partition columns: _col0 (type: int)
                  Statistics: Num rows: 0 Data size: 0 Basic stats: NONE Column stats: COMPLETE
          TableScan
            Union
              Statistics: Num rows: 0 Data size: 560 Basic stats: PARTIAL Column stats: COMPLETE
              Group By Operator
                keys: _col0 (type: int)
                mode: hash
                outputColumnNames: _col0
                Statistics: Num rows: 0 Data size: 0 Basic stats: NONE Column stats: COMPLETE
                Reduce Output Operator
                  key expressions: _col0 (type: int)
                  sort order: +
                  Map-reduce partition columns: _col0 (type: int)
                  Statistics: Num rows: 0 Data size: 0 Basic stats: NONE Column stats: COMPLETE
      Reduce Operator Tree:
        Group By Operator
          keys: KEY._col0 (type: int)
          mode: mergepartial
          outputColumnNames: _col0
          Statistics: Num rows: 0 Data size: 0 Basic stats: NONE Column stats: COMPLETE
          File Output Operator
            compressed: false
            table:
                input format: org.apache.hadoop.mapred.SequenceFileInputFormat
                output format: org.apache.hadoop.hive.ql.io.HiveSequenceFileOutputFormat
                serde: org.apache.hadoop.hive.serde2.lazybinary.LazyBinarySerDe

  Stage: Stage-3
    Map Reduce
      Map Operator Tree:
          TableScan
            Union
              Statistics: Num rows: 0 Data size: 280 Basic stats: PARTIAL Column stats: COMPLETE
              Group By Operator
                keys: _col0 (type: int)
                mode: hash
                outputColumnNames: _col0
                Statistics: Num rows: 0 Data size: 0 Basic stats: NONE Column stats: COMPLETE
                Reduce Output Operator
                  key expressions: _col0 (type: int)
                  sort order: +
                  Map-reduce partition columns: _col0 (type: int)
                  Statistics: Num rows: 0 Data size: 0 Basic stats: NONE Column stats: COMPLETE
          TableScan
            Union
              Statistics: Num rows: 0 Data size: 280 Basic stats: PARTIAL Column stats: COMPLETE
              Group By Operator
                keys: _col0 (type: int)
                mode: hash
                outputColumnNames: _col0
                Statistics: Num rows: 0 Data size: 0 Basic stats: NONE Column stats: COMPLETE
                Reduce Output Operator
                  key expressions: _col0 (type: int)
                  sort order: +
                  Map-reduce partition columns: _col0 (type: int)
                  Statistics: Num rows: 0 Data size: 0 Basic stats: NONE Column stats: COMPLETE
      Reduce Operator Tree:
        Group By Operator
          keys: KEY._col0 (type: int)
          mode: mergepartial
          outputColumnNames: _col0
          Statistics: Num rows: 0 Data size: 0 Basic stats: NONE Column stats: COMPLETE
          File Output Operator
            compressed: false
            table:
                input format: org.apache.hadoop.mapred.SequenceFileInputFormat
                output format: org.apache.hadoop.hive.ql.io.HiveSequenceFileOutputFormat
                serde: org.apache.hadoop.hive.serde2.lazybinary.LazyBinarySerDe

  Stage: Stage-4
    Map Reduce
      Map Operator Tree:
          TableScan
            Union
              Statistics: Num rows: 0 Data size: 280 Basic stats: PARTIAL Column stats: COMPLETE
              Group By Operator
                keys: _col0 (type: int)
                mode: hash
                outputColumnNames: _col0
                Statistics: Num rows: 0 Data size: 0 Basic stats: NONE Column stats: COMPLETE
                Reduce Output Operator
                  key expressions: _col0 (type: int)
                  sort order: +
                  Map-reduce partition columns: _col0 (type: int)
                  Statistics: Num rows: 0 Data size: 0 Basic stats: NONE Column stats: COMPLETE
          TableScan
            Union
              Statistics: Num rows: 0 Data size: 280 Basic stats: PARTIAL Column stats: COMPLETE
              Group By Operator
                keys: _col0 (type: int)
                mode: hash
                outputColumnNames: _col0
                Statistics: Num rows: 0 Data size: 0 Basic stats: NONE Column stats: COMPLETE
                Reduce Output Operator
                  key expressions: _col0 (type: int)
                  sort order: +
                  Map-reduce partition columns: _col0 (type: int)
                  Statistics: Num rows: 0 Data size: 0 Basic stats: NONE Column stats: COMPLETE
      Reduce Operator Tree:
        Group By Operator
          keys: KEY._col0 (type: int)
          mode: mergepartial
          outputColumnNames: _col0
          Statistics: Num rows: 0 Data size: 0 Basic stats: NONE Column stats: COMPLETE
          File Output Operator
            compressed: false
            Statistics: Num rows: 0 Data size: 0 Basic stats: NONE Column stats: COMPLETE
            table:
                input format: org.apache.hadoop.mapred.TextInputFormat
                output format: org.apache.hadoop.hive.ql.io.HiveIgnoreKeyTextOutputFormat
                serde: org.apache.hadoop.hive.serde2.lazy.LazySimpleSerDe

  Stage: Stage-5
    Map Reduce
      Map Operator Tree:
          TableScan
            alias: src
            Statistics: Num rows: 0 Data size: 280 Basic stats: PARTIAL Column stats: COMPLETE
            Select Operator
              Statistics: Num rows: 0 Data size: 280 Basic stats: PARTIAL Column stats: COMPLETE
              Limit
                Number of rows: 1
                Statistics: Num rows: 0 Data size: 280 Basic stats: PARTIAL Column stats: COMPLETE
                Reduce Output Operator
                  sort order: 
                  Statistics: Num rows: 0 Data size: 280 Basic stats: PARTIAL Column stats: COMPLETE
      Reduce Operator Tree:
        Limit
          Number of rows: 1
          Statistics: Num rows: 0 Data size: 280 Basic stats: PARTIAL Column stats: COMPLETE
          Select Operator
            expressions: 2 (type: int)
            outputColumnNames: _col0
            Statistics: Num rows: 0 Data size: 280 Basic stats: PARTIAL Column stats: COMPLETE
            File Output Operator
              compressed: false
              table:
                  input format: org.apache.hadoop.mapred.SequenceFileInputFormat
                  output format: org.apache.hadoop.hive.ql.io.HiveSequenceFileOutputFormat
                  serde: org.apache.hadoop.hive.serde2.lazybinary.LazyBinarySerDe

  Stage: Stage-6
    Map Reduce
      Map Operator Tree:
          TableScan
            alias: src
            Statistics: Num rows: 0 Data size: 280 Basic stats: PARTIAL Column stats: COMPLETE
            Select Operator
              Statistics: Num rows: 0 Data size: 280 Basic stats: PARTIAL Column stats: COMPLETE
              Limit
                Number of rows: 1
                Statistics: Num rows: 0 Data size: 280 Basic stats: PARTIAL Column stats: COMPLETE
                Reduce Output Operator
                  sort order: 
                  Statistics: Num rows: 0 Data size: 280 Basic stats: PARTIAL Column stats: COMPLETE
      Reduce Operator Tree:
        Limit
          Number of rows: 1
          Statistics: Num rows: 0 Data size: 280 Basic stats: PARTIAL Column stats: COMPLETE
          Select Operator
            expressions: 3 (type: int)
            outputColumnNames: _col0
            Statistics: Num rows: 0 Data size: 280 Basic stats: PARTIAL Column stats: COMPLETE
            File Output Operator
              compressed: false
              table:
                  input format: org.apache.hadoop.mapred.SequenceFileInputFormat
                  output format: org.apache.hadoop.hive.ql.io.HiveSequenceFileOutputFormat
                  serde: org.apache.hadoop.hive.serde2.lazybinary.LazyBinarySerDe

  Stage: Stage-7
    Map Reduce
      Map Operator Tree:
          TableScan
            alias: src
            Statistics: Num rows: 0 Data size: 280 Basic stats: PARTIAL Column stats: COMPLETE
            Select Operator
              Statistics: Num rows: 0 Data size: 280 Basic stats: PARTIAL Column stats: COMPLETE
              Limit
                Number of rows: 1
                Statistics: Num rows: 0 Data size: 280 Basic stats: PARTIAL Column stats: COMPLETE
                Reduce Output Operator
                  sort order: 
                  Statistics: Num rows: 0 Data size: 280 Basic stats: PARTIAL Column stats: COMPLETE
      Reduce Operator Tree:
        Limit
          Number of rows: 1
          Statistics: Num rows: 0 Data size: 280 Basic stats: PARTIAL Column stats: COMPLETE
          Select Operator
            expressions: 4 (type: int)
            outputColumnNames: _col0
            Statistics: Num rows: 0 Data size: 280 Basic stats: PARTIAL Column stats: COMPLETE
            File Output Operator
              compressed: false
              table:
                  input format: org.apache.hadoop.mapred.SequenceFileInputFormat
                  output format: org.apache.hadoop.hive.ql.io.HiveSequenceFileOutputFormat
                  serde: org.apache.hadoop.hive.serde2.lazybinary.LazyBinarySerDe

  Stage: Stage-0
    Fetch Operator
      limit: -1
      Processor Tree:
        ListSink





CREATE TABLE union_out_tb (id int)


insert overwrite table union_out_tb
SELECT *
FROM (
  SELECT 1 AS id
  FROM (SELECT * FROM src LIMIT 1) s1
  UNION
  SELECT 2 AS id
  FROM (SELECT * FROM src LIMIT 1) s1
  UNION
  SELECT 3 AS id
  FROM (SELECT * FROM src LIMIT 1) s2
  UNION
  SELECT 4 AS id
  FROM (SELECT * FROM src LIMIT 1) s2
) a CLUSTER BY id


select * from union_out_tb cluster by id
1
2
3
4
